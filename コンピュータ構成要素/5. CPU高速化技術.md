# CPU 高速化技術

## 命令が実行される過程

1. 命令の取り出し
2. 命令の解読
3. 実効アドレス計算
4. オペランドの取り出し
5. 命令の実行
6. 演算結果の格納

## 逐次制御方式

- 命令 ① の 1 ~ 6 が終わったら命令 ② の 1 ~ 6 が実行される
  - 直列処理

## パイプライン方式

- 命令 ① の 1 -> 2 が始まる時に命令 ② の 1 をスタートさせる
  - 一つずつずらしながら平行処理
  - ベルトコンベア作業のイメージ

### 分岐予測

- 命令処理の結果によって次に実行する命令処理が分岐する場合、どの命令処理が実行されるか予測する仕組み
- 「命令処理 1 を行って、結果が 1 であればいつも次は命令処理 0 が行われる」「今命令処理 1 を行っているから次は命令処理 0 だな」みたいな予測を立てること

### 投機実行

- 分岐予測に基づいてそれを実行すること
- 「今命令処理 1 を行っているから次は命令処理 0 だな」 -> 「命令処理 1 の結果が出る前に命令処理 0 を始めよう」
- 「命令処理 1 の結果が予測していた 1 じゃなかった」となった場合は既に始めていた命令処理 0 を破棄して正しい命令を実行する

## スーパーパイプライン方式

- パイプライン方式を更に細分化し、高速化を図る
- ベルトコンベアを長くしていっぱい同時に流せるようにするイメージ

## スーパースカラ方式

- 複数のパイプラインを使用する
- ベルトコンベアの台数を増やすイメージ

## CPU の命令体系

これ面白かった
[世の中には 2 種類の CPU がある。 CISC と RISC だ。](https://medium.dotsarc.com/%E4%B8%96%E3%81%AE%E4%B8%AD%E3%81%AB%E3%81%AF2%E7%A8%AE%E9%A1%9E%E3%81%AEcpu%E3%81%8C%E3%81%82%E3%82%8B-cisc%E3%81%A8risc%E3%81%A0-a9a69d5d9275)

### CISC(Complex Instruction Set Computer)

- 複雑命令セットコンピュータ
- コンピュータが出始めの頃に、「いかに計算効率の良いマイコンを作るか」を皆が研究していて、「1 回の命令でいかに多くのことを実行させるか」が重要とされていた
- 特徴
  - 命令フォーマットとサイズに決まりがない
  - 1 命令は複数クロックサイクルで行う
    - 数サイクルかかっても結果が一度に出るからヨシ
- パソコンやサーバは CISC
  - インテル

### RISC(Reduced Instruction Set Computer)

- 短縮命令セットコンピュータ
- 「1 回の命令でいかに多くのことを実行させるか」ということを突き詰めても、命令実行にかかる時間が増えるだけで時間短縮にはならなくない？逆に簡単な命令を高速で複数回した方が全体効率が上がるんじゃない？という発想から生まれた
- パイプライン方式を採用
- 特徴
  - 固定長命令サイズ
  - 1 クロック 1 命令でパイプライン処理で命令を実行する
- 組み込み系は RISC
  - iPhone の CPU (ARM) も RISC
  - Apple Silicon は ARM を元にして Mac 用にいじっているらしい
  - iPhone とか他の Mac デバイスと設計を共通化できている

## マルチコアプロセッサ

- 一つの CPU 内に複数のコアを備えたもの
- それぞれのコアが同時に別の処理を実行できる

## GPU (Graphics Processing Unit)

- 3D の画像処理を高速に実行する画像処理装置
- CPU がタスクを連続的に行っているときに、画像データ処理など膨大な計算量が必要になることがある
- そういう時にこいつが活躍する
- GPU が搭載された基盤のことをグラフィックボードという
  - コンピュータには通常 CPU と一緒に内蔵された内蔵 GPU が搭載されている
  - 3D ゲームとかする時はグラボが必要
- VR とか AI、機械学習で大量の画像データを読み込ませる目的で近年普及が進んでいるらしい
